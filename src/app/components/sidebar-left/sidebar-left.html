<div
  class="sidebar sidebar--left"
  [class.sidebar--collapsed]="leftSidebarCollapsed()"
>
  <div class="sidebar__header">
    <h2 class="sidebar__title" *ngIf="!leftSidebarCollapsed()">Notes</h2>
    <button class="btn btn--collapse" (click)="toggleLeftSidebar()">
      <svg
        viewBox="0 0 24 24"
        width="16"
        height="16"
        [style.transform]="
          leftSidebarCollapsed() ? 'rotate(180deg)' : 'rotate(0deg)'
        "
      >
        <path
          fill="currentColor"
          d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"
        />
      </svg>
    </button>
  </div>
  <div class="sidebar__content" *ngIf="!leftSidebarCollapsed()">
    <div class="search-box">
      <input
        class="input input--search"
        type="text"
        placeholder="Search notes..."
        [(ngModel)]="searchQuery"
      />
    </div>
    <div class="folders__list">
      <!-- New Folder Creation -->
      <div class="folder__creation">
        @if (showNewFolderInput()) {
          <div class="new-folder-form">
            <div class="folder-creation-main">
              <button 
                class="color-picker-trigger"
                [style.background-color]="selectedColor()"
                (click)="toggleColorPicker()"
                title="Choose folder color"
              >
                <svg viewBox="0 0 24 24" width="14" height="14">
                  <path fill="white" d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9c.83 0 1.5-.67 1.5-1.5 0-.39-.15-.74-.39-1.01-.23-.26-.38-.61-.38-.99 0-.83.67-1.5 1.5-1.5H16c2.76 0 5-2.24 5-5 0-4.42-4.03-8-9-8zm-5.5 9c-.83 0-1.5-.67-1.5-1.5S5.67 9 6.5 9 8 9.67 8 10.5 7.33 12 6.5 12zm3-4C8.67 8 8 7.33 8 6.5S8.67 5 9.5 5s1.5.67 1.5 1.5S10.33 8 9.5 8zm5 0c-.83 0-1.5-.67-1.5-1.5S13.67 5 14.5 5s1.5.67 1.5 1.5S15.33 8 14.5 8zm3 4c-.83 0-1.5-.67-1.5-1.5S16.67 9 17.5 9s1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/>
                </svg>
              </button>
              <input
                type="text"
                class="new-folder-input"
                placeholder="Enter folder name..."
                [(ngModel)]="newFolderName"
                (keydown)="onFolderNameKeydown($event)"
              />
            </div>
            
            @if (showColorPicker()) {
              <div class="color-picker-panel">
                <div class="color-palette">
                  @for (color of colorPalette; track color) {
                    <button
                      class="color-option"
                      [class.color-option--selected]="selectedColor() === color"
                      [style.background-color]="color"
                      (click)="selectPaletteColor(color)"
                      [title]="color"
                    ></button>
                  }
                </div>
                <div class="custom-color-section">
                  <label class="custom-color-label">Custom Color:</label>
                  <input
                    type="color"
                    class="custom-color-input"
                    [value]="selectedColor()"
                    (input)="onCustomColorChange($event)"
                  />
                </div>
              </div>
            }
            
            <div class="new-folder-actions">
              <button class="btn btn--create-folder" (click)="createFolder()">
                <svg viewBox="0 0 24 24" width="14" height="14">
                  <path fill="currentColor" d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                </svg>
              </button>
              <button class="btn btn--cancel-folder" (click)="hideCreateFolderInput()">
                <svg viewBox="0 0 24 24" width="14" height="14">
                  <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                </svg>
              </button>
            </div>
          </div>
        } @else {
          <button class="btn btn--new-folder" (click)="showCreateFolderInput()">
            <svg viewBox="0 0 24 24" width="16" height="16">
              <path fill="currentColor" d="M10 4H4c-1.11 0-2 .89-2 2v12c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2h-8l-2-2z"/>
            </svg>
            New Folder
          </button>
        }
      </div>
      
      <!-- Folders Section -->
      @for (folder of folders(); track folder.id) {
        <div class="folder__container">
          <div 
            class="folder__header"
            [class.folder__header--drag-over]="dragOverFolder() === folder.id"
            (click)="toggleFolder(folder.id)"
            (dragover)="onFolderDragOver($event, folder.id)"
            (dragleave)="onFolderDragLeave()"
            (drop)="onFolderDrop($event, folder.id)"
          >
            <div class="folder__icon" [class.folder__icon--expanded]="folder.isExpanded">
              <svg viewBox="0 0 24 24" width="16" height="16">
                <path fill="currentColor" d="M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z"/>
              </svg>
            </div>
            <div class="folder__info">
              <div class="folder__name" [style.color]="folder.color">{{ folder.name }}</div>
              <div class="folder__count">({{ (notesByFolder()[folder.id] || []).length }})</div>
            </div>
            <div class="folder__color-indicator" [style.background-color]="folder.color"></div>
          </div>
          
          @if (folder.isExpanded) {
            <div class="folder__notes">
              @for (note of (notesByFolder()[folder.id] || []); track note.id) {
                <div
                  class="note__item"
                  [class.note__item--active]="selectedNote()?.id === note.id"
                  [class.note__item--dragging]="draggedNote()?.id === note.id"
                  draggable="true"
                  (dragstart)="onNoteDragStart($event, note)"
                  (dragend)="onNoteDragEnd()"
                  (click)="selectNote(note)"
                >
                  <div class="note__drag-handle">
                    <svg viewBox="0 0 24 24" width="12" height="12">
                      <path fill="currentColor" d="M9 3h2v2H9V3zm0 4h2v2H9V7zm0 4h2v2H9v-2zm0 4h2v2H9v-2zm4-12h2v2h-2V3zm0 4h2v2h-2V7zm0 4h2v2h-2v-2zm0 4h2v2h-2v-2z"/>
                    </svg>
                  </div>
                  <div class="note__content">
                    <div class="note__title">{{ note.title }}</div>
                    <div class="note__preview">{{ note.preview }}</div>
                    <div class="note__date">{{ note.lastModified | date: "short" }}</div>
                  </div>
                </div>
              }
            </div>
          }
        </div>
      }
      
      <!-- Uncategorized Notes -->
      @if ((notesByFolder()['uncategorized'] || []).length > 0) {
        <div class="folder__container">
          <div 
            class="folder__header folder__header--uncategorized"
            [class.folder__header--drag-over]="dragOverFolder() === 'uncategorized'"
            (dragover)="onFolderDragOver($event, 'uncategorized')"
            (dragleave)="onFolderDragLeave()"
            (drop)="onFolderDrop($event, 'uncategorized')"
          >
            <div class="folder__info">
              <div class="folder__name">Uncategorized</div>
              <div class="folder__count">({{ (notesByFolder()['uncategorized'] || []).length }})</div>
            </div>
          </div>
          
          <div class="folder__notes">
            @for (note of (notesByFolder()['uncategorized'] || []); track note.id) {
              <div
                class="note__item"
                [class.note__item--active]="selectedNote()?.id === note.id"
                [class.note__item--dragging]="draggedNote()?.id === note.id"
                draggable="true"
                (dragstart)="onNoteDragStart($event, note)"
                (dragend)="onNoteDragEnd()"
                (click)="selectNote(note)"
              >
                <div class="note__drag-handle">
                  <svg viewBox="0 0 24 24" width="12" height="12">
                    <path fill="currentColor" d="M9 3h2v2H9V3zm0 4h2v2H9V7zm0 4h2v2H9v-2zm0 4h2v2H9v-2zm4-12h2v2h-2V3zm0 4h2v2h-2V7zm0 4h2v2h-2v-2zm0 4h2v2h-2v-2z"/>
                  </svg>
                </div>
                <div class="note__content">
                  <div class="note__title">{{ note.title }}</div>
                  <div class="note__preview">{{ note.preview }}</div>
                  <div class="note__date">{{ note.lastModified | date: "short" }}</div>
                </div>
              </div>
            }
          </div>
        </div>
      }
    </div>
    <button class="btn btn--new-note" (click)="createNewNote()">
      <svg viewBox="0 0 24 24" width="16" height="16">
        <path fill="currentColor" d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
      </svg>
      New Note
    </button>
  </div>
</div>
